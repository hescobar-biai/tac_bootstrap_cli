# Prepare App Template for TAC Bootstrap CLI

**ADW ID:** 073aa60c
**Date:** 2026-01-20
**Specification:** specs/issue-43-adw-073aa60c-sdlc_planner-create-prepare-app-template.md

## Overview

This feature adds a Jinja2 template for the `/prepare_app` slash command that will be generated in projects created by TAC Bootstrap CLI. The template provides a comprehensive application preparation workflow that adapts to different languages, package managers, and frameworks, enabling developers to quickly prepare their environment before running or testing their application.

## What Was Built

- `tac_bootstrap_cli/tac_bootstrap/templates/claude/commands/prepare_app.md.j2` - Jinja2 template for `/prepare_app` command
- Comprehensive test suite with 5 test cases covering different language/framework combinations
- Support for 12+ package managers (uv, poetry, pip, pipenv, pnpm, npm, yarn, bun, go mod, cargo, maven, gradle)
- Framework-specific preparation steps (Django migrations, Flask/FastAPI Alembic migrations)
- Idempotent operations safe to run multiple times

## Technical Implementation

### Files Modified

- `tac_bootstrap_cli/tac_bootstrap/templates/claude/commands/prepare_app.md.j2` (new): Core Jinja2 template file with conditional logic for different project configurations
- `tac_bootstrap_cli/tests/test_template_repo.py`: Added comprehensive test suite for prepare_app template rendering
- `tac_bootstrap_cli/pyproject.toml`: Updated dependencies
- `tac_bootstrap_cli/uv.lock`: Updated lock file

### Key Changes

1. **Multi-Package Manager Support**: Template includes conditional blocks for 12 different package managers, each with their appropriate installation command (e.g., `uv sync`, `pnpm install`, `go mod download`)

2. **Framework-Specific Migrations**: Automatically detects Django, Flask, and FastAPI frameworks and includes appropriate database migration steps

3. **Conditional Build Step**: Only includes build step when `config.commands.build` is configured, adapting section numbering dynamically

4. **Application Validation**: Uses `timeout` command to perform a quick 10-second startup validation using the project's start command

5. **Idempotent Design**: All commands are safe to run multiple times - dependency installs check if already satisfied, migrations are safe to re-run

6. **Comprehensive Test Coverage**: 5 test cases covering Python+UV, TypeScript+PNPM, Go, Django with migrations, and minimal configuration without build

### Template Architecture

The template uses Jinja2 conditionals to adapt to project configuration:

```jinja2
{% if config.project.package_manager.value == "uv" %}
  # UV-specific commands
{% elif config.project.package_manager.value == "poetry" %}
  # Poetry-specific commands
{% endif %}
```

Dynamic section numbering adjusts based on whether build command exists:
```jinja2
### {{ 5 if config.commands.build else 4 }}. Validate Application Can Start
```

## How to Use

### For CLI Users (Generating Projects)

When you run TAC Bootstrap CLI to create a new project, the `/prepare_app` command will be automatically generated in `.claude/commands/prepare_app.md`:

```bash
tac-bootstrap create my-project --language python --package-manager uv
```

The generated project will have a `/prepare_app` command adapted to its configuration.

### For Developers (Within Generated Projects)

In a project generated by TAC Bootstrap, use the `/prepare_app` command to set up your environment:

```
/prepare_app
```

This will:
1. Install all dependencies using the project's package manager
2. Check for environment configuration files
3. Run database migrations (if applicable)
4. Build the application (if build command is configured)
5. Validate the application can start
6. Optionally run quick tests

### Example Generated Commands

**Python + UV + Django:**
```bash
cd /path/to/app && uv sync
cd /path/to/app && ls -la .env* 2>/dev/null || echo "No .env files found"
cd /path/to/app && python manage.py migrate
cd /path/to/app && timeout 10s uv run python manage.py runserver
```

**TypeScript + PNPM + Next.js:**
```bash
cd /path/to/app && pnpm install
cd /path/to/app && ls -la .env* 2>/dev/null || echo "No .env files found"
cd /path/to/app && pnpm build
cd /path/to/app && timeout 10s pnpm dev
```

**Go + Go Mod:**
```bash
cd /path/to/app && go mod download
cd /path/to/app && ls -la .env* 2>/dev/null || echo "No .env files found"
cd /path/to/app && timeout 10s go run .
```

## Configuration

The template uses the following `TACConfig` variables:

- `config.project.name` - Project name
- `config.project.language` - Language enum (PYTHON, TYPESCRIPT, GO, etc.)
- `config.project.package_manager` - Package manager enum (UV, PNPM, NPM, etc.)
- `config.project.framework` - Framework enum (DJANGO, FASTAPI, NEXTJS, etc.)
- `config.commands.start` - Command to start the application
- `config.commands.test` - Command to run tests
- `config.commands.build` - Optional build command
- `config.paths.app_root` - Root directory of the application

## Testing

The template has comprehensive test coverage with 5 test cases:

```bash
cd tac_bootstrap_cli && uv run pytest tests/test_template_repo.py::TestCommandTemplates -v
```

### Test Cases

1. **test_prepare_app_template_python_uv**: Python with UV package manager, includes build
2. **test_prepare_app_template_typescript_pnpm**: TypeScript with PNPM and Next.js framework
3. **test_prepare_app_template_go**: Go with go mod package manager
4. **test_prepare_app_template_django**: Django framework with migrations
5. **test_prepare_app_template_no_build**: Minimal configuration without build command

All tests verify:
- Correct package manager command is included
- Start validation command is present
- Conditional sections (build, migrations) appear when appropriate
- Template renders without Jinja2 syntax errors
- Report section is included

## Notes

### Idempotency

All operations in the template are designed to be idempotent:
- `uv sync` checks and updates dependencies without failing if already installed
- `npm install`, `pnpm install` are safe to run multiple times
- Django migrations track which migrations are applied
- Application validation uses `timeout` to automatically stop after 10 seconds

### Framework Detection

The template automatically detects frameworks and includes appropriate steps:
- **Django**: Includes `python manage.py migrate`
- **Flask/FastAPI**: Suggests Alembic migrations if using a database
- **Next.js**: Includes build step if build command is configured
- **Generic**: Works with any framework, only includes universal steps

### Defensive Design

The template is defensive:
- Checks for `.env` files but doesn't fail if missing
- Uses `timeout` to prevent start validation from hanging
- Makes build and test steps optional
- Provides helpful echo messages when optional files are missing

### Future Enhancements

Potential improvements for future iterations:
- Health check endpoint validation for web frameworks
- Docker container preparation support
- Cloud deployment preparation steps
- Pre-commit hook installation
- Environment variable validation against `.env.example`
