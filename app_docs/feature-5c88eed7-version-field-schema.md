# Version Field Schema

**ADW ID:** 5c88eed7
**Date:** 2026-01-21
**Specification:** specs/issue-79-adw-5c88eed7-sdlc_planner-add-version-field-schema.md

## Overview

This feature adds version tracking to TAC Bootstrap configuration files. The implementation adds a `version` field (string) to track the TAC Bootstrap release version used to generate a project, while renaming the existing schema version field from `version` to `schema_version` to distinguish between these two versioning concepts.

## What Was Built

- **Version Field in TACConfig Model**: New `version: str` field with default "0.2.0" to track TAC Bootstrap release version
- **Schema Version Rename**: Existing `version: int` field renamed to `schema_version: int` to clarify it tracks config schema iteration
- **Template Updates**: Modified config.yml.j2 to render both `tac_version` and `schema_version` fields with clear documentation
- **Comprehensive Test Coverage**: Added 4 new unit tests for version field behavior and 1 integration test for template rendering
- **Backward Compatibility**: Uses Pydantic default values to handle projects without explicit version fields

## Technical Implementation

### Files Modified

- `tac_bootstrap_cli/tac_bootstrap/domain/models.py:419-427`: Added `version: str` field with default "0.2.0" and renamed `version: int` to `schema_version: int` in TACConfig model
- `tac_bootstrap_cli/tac_bootstrap/templates/config/config.yml.j2:1-9`: Updated template to render `tac_version` and `schema_version` fields with explanatory comments
- `tac_bootstrap_cli/tests/test_models.py:125,144-198`: Updated existing test to use `schema_version` and added 4 new tests for version field
- `tac_bootstrap_cli/tests/test_scaffold_service.py:622-655`: Added integration test to verify template renders both version fields correctly

### Key Changes

**Domain Model Updates:**
- Added `version: str = Field(default="0.2.0", description="TAC Bootstrap version used to generate this project")` before the `project` field in TACConfig
- Renamed existing `version: int` to `schema_version: int` to prevent naming conflicts and clarify purpose
- Updated TACConfig docstring example to show both fields

**Template Rendering:**
- Header comment now shows: `# Generated by TAC Bootstrap v{{ config.version }}`
- Renders `tac_version: "{{ config.version }}"` with comment "TAC Bootstrap release version (e.g., 0.2.0)"
- Renders `schema_version: {{ config.schema_version }}` with comment "Configuration schema version (internal)"

**Test Coverage:**
- `test_version_default()`: Verifies default version is "0.2.0"
- `test_version_custom()`: Verifies custom version strings can be provided
- `test_version_type()`: Verifies version is string type
- `test_version_in_model_dump()`: Verifies version appears in model serialization
- `test_config_yml_template_renders_version_fields()`: Integration test verifying template renders both fields and header correctly

## How to Use

### For End Users (Project Generation)

When generating a new project with TAC Bootstrap, the version field is automatically populated:

```bash
cd tac_bootstrap_cli
uv run tac-bootstrap init my-project --language python
```

The generated `config.yml` will contain:

```yaml
# TAC Bootstrap Configuration
# Generated by TAC Bootstrap v0.2.0

# TAC Bootstrap release version (e.g., 0.2.0)
tac_version: "0.2.0"

# Configuration schema version (internal)
schema_version: 1
```

### For Developers (Working with TACConfig)

When creating TACConfig instances programmatically:

```python
from tac_bootstrap.domain.models import TACConfig, ProjectSpec, Language, PackageManager

# Using default version (0.2.0)
config = TACConfig(
    project=ProjectSpec(
        name="my-app",
        language=Language.PYTHON,
        package_manager=PackageManager.UV,
    )
)
assert config.version == "0.2.0"
assert config.schema_version == 1

# Using custom version
config = TACConfig(
    version="1.5.0",
    project=ProjectSpec(...)
)
assert config.version == "1.5.0"
```

### For Legacy Projects (Backward Compatibility)

Projects generated with v0.1.0 (without version field) will automatically default to "0.2.0" when loaded via Pydantic. Future UpgradeService functionality can detect this and apply appropriate migrations.

## Configuration

### Version Field Properties

- **Type**: String
- **Default**: "0.2.0"
- **Format**: Semantic versioning recommended (X.Y.Z) but not enforced
- **Purpose**: Track which TAC Bootstrap release generated the project

### Schema Version Field Properties

- **Type**: Integer
- **Default**: 1
- **Purpose**: Track configuration schema structure changes (internal versioning)

## Testing

### Run Unit Tests

```bash
cd tac_bootstrap_cli && uv run pytest tests/test_models.py::TestTACConfig::test_version_default -v
cd tac_bootstrap_cli && uv run pytest tests/test_models.py::TestTACConfig::test_version_custom -v
cd tac_bootstrap_cli && uv run pytest tests/test_models.py::TestTACConfig::test_version_type -v
cd tac_bootstrap_cli && uv run pytest tests/test_models.py::TestTACConfig::test_version_in_model_dump -v
```

### Run Integration Test

```bash
cd tac_bootstrap_cli && uv run pytest tests/test_scaffold_service.py::TestScaffoldServiceADWCompleteness::test_config_yml_template_renders_version_fields -v
```

### Run All Tests

```bash
cd tac_bootstrap_cli && uv run pytest tests/ -v --tb=short
```

### Validation Commands

```bash
cd tac_bootstrap_cli && uv run ruff check .              # Linting
cd tac_bootstrap_cli && uv run mypy tac_bootstrap/      # Type checking
cd tac_bootstrap_cli && uv run tac-bootstrap --help     # Smoke test
```

## Notes

### Schema Version vs TAC Version

This implementation maintains two distinct versioning concepts:

- **schema_version** (int): Tracks internal config.yml schema structure changes. Incremented when fields are added/removed/changed in incompatible ways.
- **version** (str): Tracks which TAC Bootstrap release generated the project. User-facing, used for upgrade workflows and compatibility checks.

### Future Work: UpgradeService

The specification mentions future UpgradeService functionality that will:
1. Read config.yml and parse into TACConfig
2. Detect if version field was explicitly present or defaulted via Pydantic
3. If defaulted, assume project is v0.1.0 and apply appropriate migrations
4. Write updated config.yml with explicit version field

Currently, backward compatibility is handled automatically through Pydantic's default Field mechanism.

### Version Format Considerations

The current implementation accepts any string value for the version field to allow flexibility. Future work could add:
- Regex validator for semantic versioning format (X.Y.Z)
- Custom Pydantic validator to enforce version format
- Version comparison utilities for upgrade logic

### Template Rendering Changes

The template update also includes minor formatting improvements to Jinja2 whitespace control, changing `{%- endif -%}` to `{% endif %}` for consistency.
