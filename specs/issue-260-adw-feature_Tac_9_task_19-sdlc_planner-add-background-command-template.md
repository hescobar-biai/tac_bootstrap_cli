# Feature: Add background.md.j2 Command Template

## Metadata
issue_number: `260`
adw_id: `feature_Tac_9_task_19`
issue_json: `{"number":260,"title":"Add background.md.j2 command template","body":"feature\n/adw_sdlc_zte_iso\n/adw_id: feature_Tac_9_task_19\n\n**Description:**\nCreate Jinja2 template for `/background` slash command. Enables delegation to background agents for out-loop execution.\n\n**Source:** `/Volumes/MAc1/Celes/TAC/tac-9/.claude/commands/background.md`\n\n**Files affected:**\n- `/Users/hernandoescobar/Documents/Celes/tac_bootstrap/tac_bootstrap_cli/tac_bootstrap/templates/claude/commands/background.md.j2` (CREATE)\n- `/Users/hernandoescobar/Documents/Celes/tac_bootstrap/.claude/commands/background.md` (CREATE - rendered)"}`

## Feature Description
Create a Jinja2 template for the `/background` slash command that enables users to delegate long-running tasks to background agents for out-of-loop execution. This template will follow the established pattern of other command templates in the tac_bootstrap CLI, providing minimal parameterization while maintaining consistency with the project's template system.

The template will be created in two locations:
1. `tac_bootstrap_cli/tac_bootstrap/templates/claude/commands/background.md.j2` - The Jinja2 template source
2. `.claude/commands/background.md` - A rendered version for use in this repository

## User Story
As a developer using TAC Bootstrap
I want to generate the `/background` command template when scaffolding new projects
So that users of generated projects can delegate long-running tasks to background agents without blocking their main workflow

## Problem Statement
The TAC Bootstrap CLI is missing a template for the `/background` slash command. This command is essential for enabling asynchronous task delegation, allowing developers to run time-consuming operations (like extensive test suites, background builds, or analysis tasks) without blocking their interactive coding sessions. Without this template, projects generated by tac_bootstrap lack this powerful workflow capability.

## Solution Statement
Create a Jinja2 template for the `/background` command that:
1. Follows the established YAML frontmatter + markdown structure used by other command templates
2. Uses minimal parameterization (primarily static content, with optional `{{ config.project.name }}` references)
3. Provides clear documentation on how to use background agent delegation
4. Includes usage examples and parameter documentation
5. Can be rendered successfully to produce a functional command file

The solution will create both the `.j2` template file and a rendered version to validate the template works correctly.

## Relevant Files

### Existing Files (Reference)
- `tac_bootstrap_cli/tac_bootstrap/templates/claude/commands/commit.md.j2` - Example of command template structure with minimal parameterization
- `tac_bootstrap_cli/tac_bootstrap/templates/claude/commands/feature.md.j2` - Example of command template with YAML frontmatter
- `.claude/commands/commit.md` - Example of rendered command structure
- `.claude/commands/feature.md` - Example of complex command documentation
- `CLAUDE.md` - Project guidelines for template creation
- `ai_docs/doc/PLAN_TAC_BOOTSTRAP.md` - Master plan with task definitions

### New Files
- `tac_bootstrap_cli/tac_bootstrap/templates/claude/commands/background.md.j2` - New Jinja2 template
- `.claude/commands/background.md` - Rendered version for this repository's use

## Implementation Plan

### Phase 1: Foundation
1. Research existing command templates to understand structure and patterns
2. Identify minimal parameterization requirements (use of `{{ config.* }}` variables)
3. Define the content and structure for the background command documentation

### Phase 2: Core Implementation
1. Create the Jinja2 template file with:
   - YAML frontmatter with command metadata
   - Clear description of background agent delegation
   - Variables section defining expected arguments
   - Instructions section explaining how to delegate tasks
   - Usage examples showing common patterns
   - Report section defining expected output format
2. Ensure template uses defensive Jinja2 syntax with default filters where needed

### Phase 3: Integration
1. Render the template to `.claude/commands/background.md` to validate it works
2. Verify the rendered output matches expected command structure
3. Confirm consistency with other command templates in the repository

## Step by Step Tasks

### Task 1: Research and Analyze Existing Patterns
- Read 2-3 existing command templates to understand structure
- Identify common patterns in YAML frontmatter
- Note how other templates use (or don't use) Jinja2 variables
- Document the standard sections: Variables, Instructions, Run, Report

### Task 2: Create Background Command Template
- Create directory if needed: `tac_bootstrap_cli/tac_bootstrap/templates/claude/commands/`
- Write `background.md.j2` with:
  - Title: "# Background Agent Delegation"
  - YAML frontmatter (if used by other commands)
  - Variables section: defining task description and optional parameters
  - Instructions section: explaining background agent concepts
  - Run section: steps for delegating to background agent
  - Report section: expected output format
  - Usage examples showing practical scenarios
- Use minimal Jinja2 parameterization (static content preferred)
- Apply default filters for any config references: `{{ config.project.name | default('your-project') }}`

### Task 3: Create Rendered Version
- Create `.claude/commands/background.md` by rendering the template
- For rendering, use default/example config values
- Validate that rendered output is valid markdown
- Confirm it follows the same structure as other commands

### Task 4: Validation
- Execute validation commands (see Validation Commands section)
- Verify both files exist and are properly formatted
- Check that template uses consistent formatting with other command templates
- Confirm Jinja2 syntax is valid (no rendering errors)

## Testing Strategy

### Unit Tests
No automated unit tests are required for this feature, as it involves creating static template files. Manual validation will be performed by:
1. Visually inspecting the `.j2` template for correct Jinja2 syntax
2. Successfully rendering the template to produce `.claude/commands/background.md`
3. Comparing structure with existing command templates for consistency

### Edge Cases
- Template rendering with missing config values (handled by Jinja2 default filters)
- Empty or minimal background task descriptions
- Complex multi-step background tasks

## Acceptance Criteria
1. File `tac_bootstrap_cli/tac_bootstrap/templates/claude/commands/background.md.j2` exists
2. File `.claude/commands/background.md` exists as a rendered version
3. Template follows the structure of existing command templates (YAML frontmatter + markdown sections)
4. Template uses minimal Jinja2 parameterization (mostly static content)
5. Any config references use default filters to prevent rendering errors
6. Rendered version is valid markdown and matches expected command structure
7. Documentation clearly explains background agent delegation concept
8. Includes practical usage examples
9. All validation commands pass without errors

## Validation Commands
Execute all commands to validate with zero regressions:

- `cd tac_bootstrap_cli && uv run pytest tests/ -v --tb=short` - Tests unitarios
- `cd tac_bootstrap_cli && uv run ruff check .` - Linting
- `cd tac_bootstrap_cli && uv run mypy tac_bootstrap/` - Type check
- `cd tac_bootstrap_cli && uv run tac-bootstrap --help` - Smoke test

Additional validation:
- `cat tac_bootstrap_cli/tac_bootstrap/templates/claude/commands/background.md.j2` - Verify template exists
- `cat .claude/commands/background.md` - Verify rendered version exists

## Notes
- This task is part of TAC Bootstrap Phase 9 (Task 19) - completing the command template set
- The template should be mostly static since command documentation is generally project-agnostic
- Following the pattern from auto-resolved clarifications: minimal parameterization, defensive templating
- The `/background` command enables powerful asynchronous workflows but isn't yet standardized across TAC projects
- Future enhancement: Consider adding examples specific to common project types (Python, JS, etc.)
- The external source path `/Volumes/MAc1/Celes/TAC/tac-9/` is not accessible; we create the template based on standard background agent patterns
