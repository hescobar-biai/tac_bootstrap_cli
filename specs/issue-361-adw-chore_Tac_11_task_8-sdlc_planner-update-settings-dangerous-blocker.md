# Chore: Update settings.json.j2 template with dangerous_command_blocker hook

## Metadata
issue_number: `361`
adw_id: `chore_Tac_11_task_8`
issue_json: `{"number":361,"title":"Update settings.json.j2 template with dangerous_command_blocker hook","body":"chore\n/adw_sdlc_iso\n/adw_id: chore_Tac_11_task_8\n\n\nUpdate the settings.json.j2 template to include the dangerous command blocker for generated projects.\n\n**Files affected:**\n- `/Users/hernandoescobar/Documents/Celes/tac_bootstrap/tac_bootstrap_cli/tac_bootstrap/templates/claude/settings.json.j2`\n\n**Implementation details:**\n- Add new PreToolUse entry with matcher \"Bash\"\n- Hook command using package manager variable\n- Set timeout: 5 seconds\n- Maintain existing hook structure"}`

## Chore Description
Update the settings.json.j2 template to integrate the dangerous_command_blocker.py hook into the PreToolUse command chain. This ensures that all projects generated by the TAC Bootstrap CLI will have dangerous command blocking functionality built-in from the start.

The dangerous_command_blocker.py template already exists and contains comprehensive patterns to block dangerous commands like `rm -rf`, `dd`, `mkfs`, `chmod 777`, etc. The hook needs to be chained into the existing PreToolUse hook command after pre_tool_use.py and before the final `|| true` fallback.

## Relevant Files
Files to complete this chore:

1. **tac_bootstrap_cli/tac_bootstrap/templates/claude/settings.json.j2** - Template file that needs to be updated to include dangerous_command_blocker in the PreToolUse hook chain. Currently only has universal_hook_logger and pre_tool_use.py in the chain (line 30).

2. **tac_bootstrap_cli/tac_bootstrap/templates/claude/hooks/dangerous_command_blocker.py.j2** - The hook script template that already exists (293 lines). No modifications needed, just needs to be referenced in the settings template.

3. **.claude/settings.json** - Production settings file showing the correct implementation pattern (line 30). Use this as reference for how the hook chain should look.

### New Files
None - all required files already exist.

## Step by Step Tasks
IMPORTANTE: Ejecutar cada paso en orden.

### Task 1: Update settings.json.j2 PreToolUse hook chain
- Open `tac_bootstrap_cli/tac_bootstrap/templates/claude/settings.json.j2`
- Locate the PreToolUse hook command (line 30)
- Add dangerous_command_blocker.py to the command chain after pre_tool_use.py
- Use pattern: `&& {{ config.project.package_manager.value }} run $CLAUDE_PROJECT_DIR/.claude/hooks/dangerous_command_blocker.py`
- Insert before the final `|| true`
- Maintain empty string matcher ("")
- Ensure no additional fields are added (no 'enabled', 'name', etc.)

Expected result:
```json
"command": "{{ config.project.package_manager.value }} run $CLAUDE_PROJECT_DIR/.claude/hooks/universal_hook_logger.py --event PreToolUse && {{ config.project.package_manager.value }} run $CLAUDE_PROJECT_DIR/.claude/hooks/pre_tool_use.py && {{ config.project.package_manager.value }} run $CLAUDE_PROJECT_DIR/.claude/hooks/dangerous_command_blocker.py || true"
```

### Task 2: Verify template consistency
- Compare the updated template with `.claude/settings.json` (production)
- Ensure the hook chain order matches: universal_hook_logger → pre_tool_use → dangerous_command_blocker
- Confirm package manager variable format: `{{ config.project.package_manager.value }}`
- Verify path format: `$CLAUDE_PROJECT_DIR/.claude/hooks/`

### Task 3: Run validation commands
- Execute all validation commands to ensure zero regressions
- Confirm tests pass
- Verify linting passes
- Run smoke test

## Validation Commands
Ejecutar todos los comandos para validar con cero regresiones:

- `cd tac_bootstrap_cli && uv run pytest tests/ -v --tb=short` - Tests unitarios
- `cd tac_bootstrap_cli && uv run ruff check .` - Linting
- `cd tac_bootstrap_cli && uv run tac-bootstrap --help` - Smoke test

## Notes
- The dangerous_command_blocker.py script handles tool filtering internally (checks if tool_name == 'Bash')
- All hooks use empty string ("") as matcher in the template
- The hook is chained, not a separate entry - maintains single PreToolUse hook structure
- The dangerous_command_blocker.py.j2 template is already complete with all patterns (lines 35-62)
- Exit codes: 0 (allow), 2 (block), graceful error handling built-in
