# Feature: Add version field to TACConfig schema and templates

## Metadata
issue_number: `79`
adw_id: `5c88eed7`
issue_json: `{"number":79,"title":"TAREA 1: Agregar campo `version` al schema y templates","body":"### \n\n**Archivo**: `tac_bootstrap_cli/tac_bootstrap/domain/models.py`\n\n**Descripci贸n**: Agregar campo `version` al modelo `TACConfig` para trackear la versi贸n de TAC Bootstrap usada para generar el proyecto.\n\n**Cambios**:\n\n```python\n# En TACConfig, agregar campo version\nclass TACConfig(BaseModel):\n    \"\"\"Root configuration model for TAC Bootstrap.\"\"\"\n\n    version: str = Field(\n        default=\"0.2.0\",\n        description=\"TAC Bootstrap version used to generate this project\"\n    )\n    project: ProjectSpec\n    paths: PathsSpec = Field(default_factory=PathsSpec)\n    commands: CommandsSpec = Field(default_factory=CommandsSpec)\n    agentic: AgenticSpec = Field(default_factory=AgenticSpec)\n    claude: ClaudeConfig = Field(default_factory=ClaudeConfig)\n```\n\n**Archivo**: `tac_bootstrap_cli/tac_bootstrap/templates/config/config.yml.j2`\n\n**Cambios**:\n\n```yaml\n# TAC Bootstrap Configuration\n# Generated by TAC Bootstrap v{{ config.version }}\n\nversion: \"{{ config.version }}\"\n\nproject:\n  name: \"{{ config.project.name }}\"\n  # ... resto del template\n```\n\n**Nota Importante**: Los proyectos generados actualmente (v0.1.0) NO tienen campo `version` en su `config.yml`. El `UpgradeService` debe detectar esto y asumir `\"0.1.0\"` como versi贸n default.\n\n**Criterios de Aceptaci贸n**:\n- [ ] Campo `version` existe en `TACConfig` con default \"0.2.0\"\n- [ ] Template `config.yml.j2` incluye campo version\n- [ ] Tests existentes pasan\n- [ ] Nuevo test verifica que version se genera correctamente\n- [ ] Proyectos sin campo version se asumen como v0.1.0"}`

## Feature Description
This feature adds version tracking to TAC Bootstrap configuration files. The goal is to track which version of TAC Bootstrap was used to generate each project, enabling future upgrade paths and compatibility checks. The version field will be added to the Pydantic TACConfig model and rendered in generated config.yml files. This change establishes the foundation for an upgrade/migration system that can detect and handle projects created with older versions.

## User Story
As a TAC Bootstrap user
I want the generated projects to track which TAC Bootstrap version created them
So that upgrade tools can detect version mismatches and apply appropriate migrations when needed

## Problem Statement
Currently, projects generated by TAC Bootstrap have no way to identify which version of the generator was used to create them. This creates challenges for:
- **Upgrade workflows**: No way to detect if a project needs configuration migration
- **Compatibility**: Cannot verify if config.yml structure matches expected schema
- **Support**: Difficult to troubleshoot issues without knowing generator version
- **Documentation**: Users can't easily determine which features are available

The issue note mentions that v0.1.0 projects lack a version field entirely, and future UpgradeService functionality will need to assume "0.1.0" as the default for these legacy projects.

## Solution Statement
Add a `version` field to the TACConfig Pydantic model with a default value of "0.2.0" (string format). This field will be:
- **In the model**: Added as a Pydantic Field with default value, appearing before the `project` field in TACConfig
- **In templates**: Rendered at the top of config.yml.j2 both in the header comment and as a YAML field
- **Backward compatible**: Uses default value mechanism so missing fields default to "0.2.0"
- **Type-safe**: Validated by Pydantic as a string field

For backward compatibility, the existing `version: int` field in TACConfig (currently defaults to 1, represents schema version) will remain unchanged. The new field tracks the TAC Bootstrap release version.

**IMPORTANT CLARIFICATION**: After reviewing the existing code, there is already a `version: int = Field(default=1, description="Configuration schema version")` at line 422 in models.py. The issue description shows adding `version: str` which would create a naming conflict. Based on the issue context about tracking TAC Bootstrap version vs schema version, we will:
1. Rename the existing `version` field to `schema_version` to represent config schema iteration
2. Add new `version` field as string to represent TAC Bootstrap release version

This prevents confusion between two different versioning concepts.

## Relevant Files
Files that need modification for this feature:

- **tac_bootstrap_cli/tac_bootstrap/domain/models.py** (line 422)
  - Current: Has `version: int` for schema versioning
  - Change: Rename to `schema_version: int`, add new `version: str` field for TAC Bootstrap version
  - Why: Core domain model that needs the version tracking field

- **tac_bootstrap_cli/tac_bootstrap/templates/config/config.yml.j2** (lines 1-5)
  - Current: Header says "Auto-generated", has `version: 1` for schema
  - Change: Update header to include TAC version, add `tac_version` YAML field
  - Why: Template that renders the configuration file

- **tac_bootstrap_cli/tests/test_models.py** (lines 114-130)
  - Current: Tests check `config.version == 1` for schema version
  - Change: Update to test `schema_version`, add tests for new `version` field
  - Why: Existing tests will break with field rename, need new coverage

### New Files
None. This is a modification to existing model and template.

## Implementation Plan

### Phase 1: Model Schema Changes
Update the TACConfig Pydantic model to include both schema_version (renamed from version) and the new TAC Bootstrap version field. Ensure backward compatibility through default values.

### Phase 2: Template Updates
Modify the config.yml.j2 template to render both version fields in the generated configuration, with clear documentation in comments distinguishing schema version from TAC Bootstrap version.

### Phase 3: Test Coverage
Add comprehensive unit tests for the new version field, update existing tests for the renamed schema_version field, and verify template rendering produces expected output.

## Step by Step Tasks
IMPORTANTE: Ejecutar cada paso en orden.

### Task 1: Update TACConfig model with version fields
- Open `tac_bootstrap_cli/tac_bootstrap/domain/models.py`
- Locate the TACConfig class (line 394)
- Rename existing `version: int` field to `schema_version: int` (keep default=1)
- Add new `version: str` field with default="0.2.0" BEFORE the `project` field
- Update the TACConfig docstring example to show both fields
- Ensure field descriptions clearly distinguish between schema version and TAC version

### Task 2: Update config.yml.j2 template
- Open `tac_bootstrap_cli/tac_bootstrap/templates/config/config.yml.j2`
- Update line 2 header comment to: `# Generated by TAC Bootstrap v{{ config.version }}`
- Keep existing `version: 1` but rename to `schema_version: {{ config.schema_version }}`
- Add new field after schema_version: `tac_version: "{{ config.version }}"`
- Add a comment above tac_version explaining it tracks TAC Bootstrap release

### Task 3: Update existing tests for schema_version rename
- Open `tac_bootstrap_cli/tests/test_models.py`
- Find TestTACConfig.test_minimal_config (line 114)
- Change assertion from `assert config.version == 1` to `assert config.schema_version == 1`
- Search for any other references to `.version` in test file and update to `.schema_version`

### Task 4: Add new tests for version field
- In `tac_bootstrap_cli/tests/test_models.py`, add to TestTACConfig class:
  - `test_version_default()`: Verify default version is "0.2.0"
  - `test_version_custom()`: Verify custom version string can be provided
  - `test_version_type()`: Verify version is string type
- Add test to verify version field appears in model_dump() output

### Task 5: Add integration test for template rendering
- In `tac_bootstrap_cli/tests/test_scaffold_service.py` (or create new template test file):
  - Create test that renders config.yml.j2 template with TACConfig instance
  - Assert rendered YAML contains both `schema_version: 1` and `tac_version: "0.2.0"`
  - Assert header comment contains "Generated by TAC Bootstrap v0.2.0"
  - Verify YAML can be parsed back and fields are correct

### Task 6: Run validation commands and verify zero regressions
- Execute all validation commands (pytest, ruff, mypy, smoke test)
- Fix any linting/type checking issues
- Ensure all tests pass with zero regressions
- Verify tac-bootstrap --help runs without errors

## Testing Strategy

### Unit Tests
- **Model field tests**: Verify version field exists, has correct default, accepts custom values
- **Model schema tests**: Verify schema_version rename doesn't break serialization
- **Field type tests**: Confirm version is str, schema_version is int
- **Default value tests**: Verify both fields populate correctly when not provided
- **Pydantic validation**: Test that version field appears in model schema and model_dump()

### Integration Tests
- **Template rendering**: Verify config.yml.j2 renders both version fields correctly
- **YAML parsing**: Ensure rendered config can be parsed back into TACConfig model
- **Comment rendering**: Verify Jinja2 template header shows TAC version correctly

### Edge Cases
- **Missing version field**: Load config.yml without version field (v0.1.0 projects)
  - Expected: Pydantic default should populate version="0.2.0"
- **Custom version**: Provide version="1.5.0" in config
  - Expected: Should accept and store custom version
- **Invalid version format**: Test non-semver strings (will not enforce format in this task)
  - Expected: Should accept any string (validation is future work)
- **Schema version edge cases**: Test schema_version with non-default values
  - Expected: Should work exactly as before the rename

## Acceptance Criteria
- [ ] Campo `version: str` existe en `TACConfig` con default "0.2.0"
- [ ] Campo `schema_version: int` existe (renamed from `version`) con default 1
- [ ] Template `config.yml.j2` incluye campo `tac_version` y `schema_version`
- [ ] Header comment en template muestra "Generated by TAC Bootstrap v{{ config.version }}"
- [ ] Tests existentes pasan sin regresiones
- [ ] Nuevos tests verifican que version se genera correctamente
- [ ] Tests verifican que schema_version mantiene comportamiento anterior
- [ ] Template rendering test verifica ambos campos en YAML generado
- [ ] Proyectos sin campo version usan default "0.2.0" via Pydantic

## Validation Commands
Ejecutar todos los comandos para validar con cero regresiones:

- `cd tac_bootstrap_cli && uv run pytest tests/ -v --tb=short` - Tests unitarios
- `cd tac_bootstrap_cli && uv run ruff check .` - Linting
- `cd tac_bootstrap_cli && uv run mypy tac_bootstrap/` - Type check
- `cd tac_bootstrap_cli && uv run tac-bootstrap --help` - Smoke test

## Notes

### UpgradeService Future Work
The issue mentions UpgradeService logic for detecting missing version fields, but no UpgradeService exists in the current codebase (grep returned no results). This appears to be future functionality. The current implementation uses Pydantic's default value mechanism to handle missing fields, which provides backward compatibility for v0.1.0 projects automatically.

When UpgradeService is implemented in the future, it can:
1. Read config.yml and parse into TACConfig
2. Check if version field was explicitly present or defaulted
3. If defaulted, assume project is v0.1.0 and apply migrations
4. Write updated config.yml with explicit version field

### Version Format Considerations
- This task uses semantic versioning format (X.Y.Z) but does NOT enforce it with validation
- Future work could add regex validator for semver format
- For now, any string is accepted to allow flexibility

### Schema Version vs TAC Version
- **schema_version**: Tracks config.yml schema structure changes (internal)
- **version** (TAC version): Tracks which TAC Bootstrap release generated the project (user-facing)
- These are separate concerns and should remain distinct fields

### Backward Compatibility Strategy
Pydantic's default Field mechanism automatically provides backward compatibility:
- Old projects without `version` field will get "0.2.0" when loaded
- Old projects without `schema_version` (but with old `version: 1`) will need migration
- This task focuses on new projects; actual migration logic is out of scope
