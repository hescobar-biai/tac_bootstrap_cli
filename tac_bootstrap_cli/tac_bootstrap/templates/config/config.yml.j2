# TAC Bootstrap Configuration
# Generated by TAC Bootstrap v{{ config.version }}
# Documentation: https://github.com/celes-app/tac-cli-dist

# TAC Bootstrap release version (e.g., 0.10.2)
version: "{{ config.version }}"

# Configuration schema version (internal)
schema_version: {{ config.schema_version }}

project:
  name: "{{ config.project.name }}"
  mode: "{{ config.project.mode.value }}"
  repo_root: "{{ config.project.repo_root }}"
  language: "{{ config.project.language.value }}"
{% if config.project.framework %}
  framework: "{{ config.project.framework.value }}"
{% endif %}
  architecture: "{{ config.project.architecture.value }}"
  package_manager: "{{ config.project.package_manager.value }}"

paths:
  app_root: "{{ config.paths.app_root }}"
  agentic_root: "{{ config.paths.agentic_root }}"
  prompts_dir: "{{ config.paths.prompts_dir }}"
  adws_dir: "{{ config.paths.adws_dir }}"
  specs_dir: "{{ config.paths.specs_dir }}"
  logs_dir: "{{ config.paths.logs_dir }}"
  scripts_dir: "{{ config.paths.scripts_dir }}"
  worktrees_dir: "{{ config.paths.worktrees_dir }}"

commands:
  start: "{{ config.commands.start }}"
  test: "{{ config.commands.test }}"
{% if config.commands.lint %}
  lint: "{{ config.commands.lint }}"
{% endif %}
{% if config.commands.typecheck %}
  typecheck: "{{ config.commands.typecheck }}"
{% endif %}
{% if config.commands.format %}
  format: "{{ config.commands.format }}"
{% endif %}
{% if config.commands.build %}
  build: "{{ config.commands.build }}"
{% endif %}

agentic:
  provider: "{{ config.agentic.provider.value }}"
  target_branch: "{{ config.agentic.target_branch | default('main') }}"
  model_policy:
    default: "{{ config.agentic.model_policy.default }}"
    heavy: "{{ config.agentic.model_policy.heavy }}"
    fallback: "{{ config.agentic.model_policy.fallback | default('haiku') }}"  # Fallback model when quota is exhausted
    # Optional: Fully qualified model IDs (override hardcoded defaults via config or env vars)
    opus_model: "{{ config.agentic.model_policy.opus_model or 'claude-opus-4-5-20251101' }}"
    sonnet_model: "{{ config.agentic.model_policy.sonnet_model or 'claude-sonnet-4-5-20250929' }}"
    haiku_model: "{{ config.agentic.model_policy.haiku_model or 'claude-haiku-4-5-20251001' }}"
    # Optional: Claude Code subagent model override
{% if config.agentic.model_policy.subagent_model %}
    subagent_model: "{{ config.agentic.model_policy.subagent_model }}"
{% else %}
    # subagent_model: "claude-sonnet-4-5-20250929"
{% endif %}
    # Optional: Custom API base URL (for proxies or alternative endpoints)
{% if config.agentic.model_policy.base_url %}
    base_url: "{{ config.agentic.model_policy.base_url }}"
{% else %}
    # base_url: "https://your-proxy.example.com"
{% endif %}
  worktrees:
    enabled: {{ config.agentic.worktrees.enabled | lower }}
    max_parallel: {{ config.agentic.worktrees.max_parallel }}
    naming: "{{ config.agentic.worktrees.naming }}"
  logging:
    level: "{{ config.agentic.logging.level }}"
    capture_agent_transcript: {{ config.agentic.logging.capture_agent_transcript | lower }}
    run_id_strategy: "{{ config.agentic.logging.run_id_strategy.value }}"
  safety:
    require_tests_pass: {{ config.agentic.safety.require_tests_pass | lower }}
    require_review_artifacts: {{ config.agentic.safety.require_review_artifacts | lower }}
{% if config.agentic.safety.allowed_paths %}
    allowed_paths:
{% for path in config.agentic.safety.allowed_paths %}
      - "{{ path }}"
{% endfor %}
{% endif %}
{% if config.agentic.safety.forbidden_paths %}
    forbidden_paths:
{% for path in config.agentic.safety.forbidden_paths %}
      - "{{ path }}"
{% endfor %}
{% endif %}
  workflows:
    default: "{{ config.agentic.workflows.default.value }}"
    available:
{% for workflow in config.agentic.workflows.available %}
      - "{{ workflow.value }}"
{% endfor %}
  token_optimization:
    max_issue_body_length: {{ config.agentic.token_optimization.max_issue_body_length | default(2000) }}  # Truncate issue body to reduce token usage
    max_file_reference_size: {{ config.agentic.token_optimization.max_file_reference_size | default(5000) }}  # Max chars per referenced file
    max_clarification_length: {{ config.agentic.token_optimization.max_clarification_length | default(1000) }}  # Max chars for clarification responses
    max_docs_planning: {{ config.agentic.token_optimization.max_docs_planning | default(2) }}  # Max documentation files to load in planning phase
    max_summary_tokens_planning: {{ config.agentic.token_optimization.max_summary_tokens_planning | default(200) }}  # Max tokens per doc summary in planning
    max_file_references: {{ config.agentic.token_optimization.max_file_references | default(3) }}  # Max number of files to load from issue references
    max_screenshots: {{ config.agentic.token_optimization.max_screenshots | default(3) }}  # Max screenshots to upload in review phase

claude:
  settings:
    project_name: "{{ config.claude.settings.project_name }}"
    preferred_style: "{{ config.claude.settings.preferred_style }}"
    allow_shell: {{ config.claude.settings.allow_shell | lower }}
  commands:
    prime: "{{ config.claude.commands.prime }}"
    start: "{{ config.claude.commands.start }}"
    build: "{{ config.claude.commands.build }}"
    test: "{{ config.claude.commands.test }}"
    review: "{{ config.claude.commands.review }}"
    ship: "{{ config.claude.commands.ship }}"

templates:
  plan_template: "{{ config.templates.plan_template }}"
  chore_template: "{{ config.templates.chore_template }}"
  feature_template: "{{ config.templates.feature_template }}"
  bug_template: "{{ config.templates.bug_template }}"
  review_template: "{{ config.templates.review_template }}"

{% if config.orchestrator %}
orchestrator:
  enabled: {{ config.orchestrator.enabled | lower }}
  api_base_url: "{{ config.orchestrator.api_base_url }}"
  ws_base_url: "{{ config.orchestrator.ws_base_url }}"
  frontend_port: {{ config.orchestrator.frontend_port }}
  websocket_port: {{ config.orchestrator.websocket_port }}
  database_url: "{{ config.orchestrator.database_url }}"
  polling_interval: {{ config.orchestrator.polling_interval }}
{% endif %}

# Validation strictness: permissive, standard, or strict
validation_mode: "{{ config.validation_mode | default('standard') }}"

bootstrap:
  create_git_repo: {{ config.bootstrap.create_git_repo | lower }}
  initial_commit: {{ config.bootstrap.initial_commit | lower }}
  license: "{{ config.bootstrap.license }}"
  readme: {{ config.bootstrap.readme | lower }}
  backup_retention: {{ config.bootstrap.backup_retention | default(3) }}  # Number of backups to keep during upgrade (1-10)

# Optional: Data Engineering Configuration
{% if config.data_engineering %}
data_engineering:
  enabled: {{ config.data_engineering.enabled | lower }}
{% if config.data_engineering.dbt %}
  dbt:
    project_name: "{{ config.data_engineering.dbt.project_name }}"
    default_target: "{{ config.data_engineering.dbt.default_target }}"
    default_schema: "{{ config.data_engineering.dbt.default_schema }}"
{% if config.data_engineering.dbt.targets %}
    targets:
{% for target in config.data_engineering.dbt.targets %}
      - name: "{{ target.name }}"
        adapter: "{{ target.adapter }}"
{% if target.project_id %}
        project_id: "{{ target.project_id }}"
{% endif %}
{% if target.dataset %}
        dataset: "{{ target.dataset }}"
{% endif %}
{% if target.host %}
        host: "{{ target.host }}"
{% endif %}
{% if target.dbname %}
        dbname: "{{ target.dbname }}"
{% endif %}
{% endfor %}
{% endif %}
{% endif %}
{% if config.data_engineering.bigquery %}
  bigquery:
    project_id: "{{ config.data_engineering.bigquery.project_id }}"
    dataset: "{{ config.data_engineering.bigquery.dataset }}"
    location: "{{ config.data_engineering.bigquery.location }}"
{% endif %}
{% if config.data_engineering.cloud_storage %}
  cloud_storage:
    bucket: "{{ config.data_engineering.cloud_storage.bucket }}"
    region: "{{ config.data_engineering.cloud_storage.region }}"
{% endif %}
{% endif %}

# Optional: ML/Forecasting Configuration
{% if config.ml %}
ml:
  enabled: {{ config.ml.enabled | lower }}
{% if config.ml.frameworks %}
  frameworks:
{% for fw in config.ml.frameworks %}
    - "{{ fw.value }}"
{% endfor %}
{% endif %}
  pipeline_type: "{{ config.ml.pipeline_type }}"
{% if config.ml.metrics %}
  metrics:
{% for metric in config.ml.metrics %}
    - "{{ metric }}"
{% endfor %}
{% endif %}
{% if config.ml.experiment_tracking %}
  experiment_tracking: "{{ config.ml.experiment_tracking }}"
{% endif %}
{% endif %}

# Optional: Infrastructure Configuration
{% if config.infrastructure %}
infrastructure:
  cloud_provider: "{{ config.infrastructure.cloud_provider }}"
  iac_tool: "{{ config.infrastructure.iac_tool }}"
{% if config.infrastructure.regions %}
  regions:
{% for key, value in config.infrastructure.regions.items() %}
    {{ key }}: "{{ value }}"
{% endfor %}
{% endif %}
{% endif %}

# TAC Bootstrap Metadata (auto-generated)
{% if config.metadata %}
metadata:
  generated_at: "{{ config.metadata.generated_at }}"
  generated_by: "{{ config.metadata.generated_by }}"
  schema_version: {{ config.metadata.schema_version }}
  last_upgrade: {% if config.metadata.last_upgrade %}"{{ config.metadata.last_upgrade }}"{% else %}null{% endif %}
{% endif %}
