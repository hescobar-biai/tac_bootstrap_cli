# Load Context Bundle

Recover context from a previous session by loading a context bundle. Based on the `Instructions` below, take the `Variables` follow the `Run` section to load and restore context from a bundle file. Then follow the `Report` section to report the results of your work.

## Variables

bundle_path: $ARGUMENT (optional) - Path to specific bundle file
session_id: $ARGUMENT (optional) - Session ID to load (e.g., "abc123-def456")

## Instructions

- Context bundles are JSONL files that track file operations during Claude Code sessions
- They are automatically created by the `context_bundle_builder` hook
- Bundles are stored at: `{{ config.paths.logs_dir }}/context_bundles/session_{session_id}.jsonl`
- Each JSONL entry represents a file operation (read, write, edit, notebookedit) with metadata

**JSONL Entry Schema:**
```json
{
    "timestamp": "2024-01-26T14:30:45.123456",
    "operation": "read|write|edit|notebookedit",
    "file_path": "relative/path/to/file.py",
    "status": "success|error",
    "session_id": "uuid-string",
    "tool_input": {...}
}
```

**Use Cases:**
- Resume work after session failure or timeout
- Understand what files a previous agent accessed
- Debug agent behavior by reviewing operation history
- Recover context after interruptions

**Important Notes:**
- If neither bundle_path nor session_id is provided, the most recent bundle will be loaded
- Files referenced in bundles may no longer exist - this is handled gracefully
- Only successful operations are restored to context
- Failed Write operations are tracked but not restored

## Run

1. **Locate the bundle file:**
   - If `bundle_path` is provided: Use it directly
   - If `session_id` is provided: Construct path as `{{ config.paths.logs_dir }}/context_bundles/session_{session_id}.jsonl`
   - Otherwise: Find the most recent file in `{{ config.paths.logs_dir }}/context_bundles/` directory
   - Use Bash to list files: `ls -t {{ config.paths.logs_dir }}/context_bundles/session_*.jsonl | head -1`

2. **Verify bundle file exists:**
   - Use Read tool to check if the file exists
   - If file is missing, report error and stop
   - Report which bundle file is being loaded

3. **Read and parse JSONL:**
   - Use Read tool to load the entire bundle file
   - Parse each line as a separate JSON object
   - Extract file paths and operation types from entries
   - Track unique files and operation counts

4. **Re-read key files to restore context:**
   - Filter entries by operation type (prioritize 'read' and 'edit' operations)
   - Get list of unique file paths from the bundle
   - For each unique file path:
     - Use Read tool to load the file into context
     - Track whether the file exists or is missing
     - Handle missing files gracefully (skip and continue)
   - Focus on files that were successfully read or edited (status: "success")
   - Skip files that had error status or were only written

5. **Report summary:**
   - List the bundle file path loaded
   - Report total number of JSONL entries found
   - List files successfully restored with their paths
   - List files that are missing (no longer exist)
   - Show operation summary: X reads, Y writes, Z edits

## Examples

**Example 1: Load most recent bundle**
```
User: /load_bundle
Agent: No arguments provided, loading most recent bundle...
       Found: {{ config.paths.logs_dir }}/context_bundles/session_abc123.jsonl
       Parsing 45 entries...
       Restoring context from 12 unique files...
```

**Example 2: Load specific session by ID**
```
User: /load_bundle session_id=abc123-def456-789012
Agent: Loading bundle for session: abc123-def456-789012
       Found: {{ config.paths.logs_dir }}/context_bundles/session_abc123-def456-789012.jsonl
       Parsing 32 entries...
       Restoring context from 8 unique files...
```

**Example 3: Load specific bundle file**
```
User: /load_bundle bundle_path={{ config.paths.logs_dir }}/context_bundles/session_old_session.jsonl
Agent: Loading bundle: {{ config.paths.logs_dir }}/context_bundles/session_old_session.jsonl
       Parsing 18 entries...
       Restoring context from 5 unique files...
       Warning: 2 files no longer exist and were skipped
```

**Example 4: Handle missing files gracefully**
```
Bundle contains reference to: src/deleted_feature.py
Agent: Attempting to read src/deleted_feature.py... (file not found, skipping)
       Continuing with remaining files...
```

## Report

Report to the user:

1. **Bundle Information:**
   - Bundle file path loaded
   - Total number of entries in the bundle
   - Session ID extracted from the bundle

2. **Context Restoration:**
   - Files successfully restored (with relative paths)
   - Files missing/not found (with relative paths)
   - Total files processed

3. **Operation Summary:**
   - Number of read operations
   - Number of write operations
   - Number of edit operations
   - Number of notebookedit operations

**Format:**
```
Context bundle loaded: {{ config.paths.logs_dir }}/context_bundles/session_{session_id}.jsonl
Total entries: {count}
Session ID: {session_id}

Files restored ({count}):
  - {file_path_1}
  - {file_path_2}
  - ...

Files missing ({count}):
  - {missing_file_1}
  - {missing_file_2}

Operation summary:
  - {read_count} reads
  - {write_count} writes
  - {edit_count} edits
  - {notebookedit_count} notebook edits

Context successfully restored from {restored_count}/{total_files} files.
```
