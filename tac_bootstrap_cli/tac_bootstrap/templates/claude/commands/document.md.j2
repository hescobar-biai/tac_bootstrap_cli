# Document Feature

Generate markdown documentation for implemented features in {{ config.project.name }} by analyzing code changes and specifications.

## Variables

adw_id: $1
spec_path: $2 if provided, otherwise leave blank
documentation_screenshots_dir: $3 if provided, otherwise leave blank

## Instructions

**âš¡ TOKEN OPTIMIZATION RULES (CRITICAL):**
- **DO NOT repeat spec content** - Summarize in 1-2 sentences what was built
- **Keep docs under 600 tokens** - Technical docs should be concise
- **Focus on "what" and "how to use"** - Skip implementation details unless critical
- **Use code blocks** - Show don't tell with examples
- **Bullet points for features** - No prose, just facts

### 1. Analyze Changes
- Run `git diff origin/main --stat` to see changed files
- Run `git diff origin/main --name-only` for list of files
- For significant changes (>50 lines), run `git diff origin/main <file>`

### 2. Read Specification (if provided)
- If `spec_path` is provided, read to understand:
  - Original requirements and objectives
  - Expected functionality
  - Success criteria

### 3. Extract IDK Keywords
- Analyze the code changes and extract 3-8 Information Dense Keywords (IDK)
- If `canonical_idk.yml` exists, prioritize keywords from it
- Supplement canonical terms with feature-specific keywords as needed
- Keywords should represent core concepts, patterns, technologies, or domain terms

### 4. Generate Documentation
- Create file in `{{ config.paths.app_docs_dir | default('app_docs') }}/` with name: `feature-{adw_id}-{descriptive-name}.md`
- CRITICAL: Create the documentation using RELATIVE path `{{ config.paths.app_docs_dir | default('app_docs') }}/feature-{adw_id}-{descriptive-name}.md`
- CRITICAL: NEVER use absolute paths (starting with /). ALWAYS use relative paths to current directory.
- CRITICAL: When using the Write tool, use ONLY `{{ config.paths.app_docs_dir | default('app_docs') }}/filename.md`, NOT `/Users/.../{{ config.paths.app_docs_dir | default('app_docs') }}/filename.md`
- Follow the documentation format below including YAML frontmatter
- Focus on:
  - What was built (based on git diff)
  - How it works (technical implementation)
  - How to use it (user perspective)
  - Required configuration or setup
  - Testing instructions with executable bash commands

### 5. Update Conditional Documentation
- After creating the file, read `.claude/commands/conditional_docs.md`
- Add entry for the new file with appropriate conditions

## Documentation Format

```md
---
doc_type: feature
adw_id: {{ config.adw_id | default('N/A') }}
date: <current date YYYY-MM-DD>
idk:
  - keyword1
  - keyword2
  - keyword3
tags:
  - feature
  - {{ config.capability | default('general') }}
related_code:
  - path/to/file1.py
  - path/to/test_file1.py
---

# <Feature Title>

**ADW ID:** <adw_id>
**Date:** <current date>
**Specification:** <spec_path or "N/A">

## Overview

<2-3 sentences summarizing what was built and why>

## What Was Built

<List components/features implemented based on git diff analysis>

- <Component/feature 1>
- <Component/feature 2>

## Technical Implementation

### Files Modified

<List key files changed with description>

- `{{ config.paths.app_root }}/<path>`: <what was changed/added>

### Key Changes

<Describe most important technical changes in 3-5 bullet points>

## How to Use

<Step by step instructions to use the new feature>

1. <Step 1>
2. <Step 2>

## Configuration

<Configuration options, environment variables, or settings>

## Testing

<Description of how to test the feature>

```bash
<executable command 1>
```

<Description of additional test if needed>

```bash
<executable command 2>
```

## Notes

<Additional context, limitations, or future considerations>
```

## Report

CRITICAL OUTPUT FORMAT - You MUST follow this exactly:

YOUR FINAL OUTPUT MUST BE EXACTLY ONE LINE containing only the RELATIVE path like:
```
{{ config.paths.app_docs_dir | default('app_docs') }}/feature-e4dc9574-feature-name.md
```

DO NOT include:
- Any explanation or commentary
- Phrases like "Perfect!", "I created...", "The documentation file is at..."
- Markdown formatting around the path
- Multiple lines
- Absolute paths (starting with /)

ONLY output the bare RELATIVE path. This is machine-parsed.
