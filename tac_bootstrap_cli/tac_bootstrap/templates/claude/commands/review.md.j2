# Review

Review work done against a specification file ({{ config.paths.specs_dir }}/*.md) to ensure the implementation meets requirements.

## Variables

adw_id: $ARGUMENT
spec_file: $ARGUMENT
agent_name: $ARGUMENT if provided, otherwise use 'review_agent'
review_image_dir: `<absolute path to codebase>/agents/<adw_id>/<agent_name>/review_img/`

## Instructions

- Verify current branch with `git branch` to understand context
- Run `git diff origin/main` to see changes made in current branch
- Find spec file by searching {{ config.paths.specs_dir }}/*.md that matches the branch
- Read the spec file to understand requirements

### Validation Steps

1. **Verify syntax and types**
{% if config.commands.typecheck %}
   ```bash
   {{ config.commands.typecheck }}
   ```
{% endif %}

2. **Verify linting**
{% if config.commands.lint %}
   ```bash
   {{ config.commands.lint }}
   ```
{% endif %}

3. **Run tests**
{% if config.commands.test %}
   ```bash
   {{ config.commands.test }}
   ```
{% endif %}

4. **Verify application works**
{% if config.commands.start %}
   ```bash
   {{ config.commands.start }} --help
   ```
{% endif %}

### Issue Severity

- `skippable` - Does not block release but is a problem
- `tech_debt` - Does not block release but will create technical debt
- `blocker` - Blocks release, must be resolved immediately

## Report

After completing validation, generate TWO outputs:

### 1. JSON Report (backward compatible)

- IMPORTANT: Return results exclusively as JSON array.
- `success` must be `true` if there are NO BLOCKING issues
- `success` must be `false` ONLY if there are BLOCKING issues

```json
{
    "success": "boolean - true if no BLOCKING issues",
    "review_summary": "string - 2-4 sentences describing what was built and if it meets the spec",
    "validation_results": {
        "syntax_check": "passed|failed",
        "type_check": "passed|failed",
        "linting": "passed|failed",
        "tests": "passed|failed",
        "app_smoke": "passed|failed"
    },
    "review_issues": [
        {
            "review_issue_number": "number",
            "issue_description": "string",
            "issue_resolution": "string",
            "issue_severity": "skippable|tech_debt|blocker"
        }
    ]
}
```

### 2. Validation Checklist (NEW)

Generate a validation checklist markdown file and save it alongside the spec file.

**Checklist Generation Instructions:**

1. Parse the spec file to extract:
   - Feature name/title from first heading
   - All items from `## Acceptance Criteria` section (lines starting with `- [ ]`)
   - All commands from `## Validation Commands` section
   - Current git branch name
   - Current date

2. Map `validation_results` to checklist items with proper checkbox states:
   - `passed` → `- [x] <check name> - PASSED`
   - `failed` → `- [ ] <check name> - FAILED`

3. Generate checklist markdown in this exact format:

```markdown
# Validation Checklist: <Feature Name>

**Spec:** `<spec_file_path>`
**Branch:** `<current_branch>`
**Review ID:** `<adw_id>`
**Date:** `<current_date>`

## Automated Technical Validations

- [x] Syntax and type checking - <PASSED|FAILED>
- [x] Linting - <PASSED|FAILED>
- [x] Unit tests - <PASSED|FAILED>
- [x] Application smoke test - <PASSED|FAILED>

## Acceptance Criteria

<!-- Extracted from spec file "## Acceptance Criteria" section -->
<copy all lines starting with "- [ ]" from spec's Acceptance Criteria section>

## Validation Commands Executed

```bash
<copy all commands from spec's "## Validation Commands" section>
```

## Review Summary

<review_summary from JSON output>

## Review Issues

<format all issues from review_issues array with severity>

---
*Generated by `/review` command - TAC Bootstrap CLI*
```

4. Save the checklist to:
   - File path: `<spec_file_directory>/<spec_file_basename>-checklist.md`
   - Example: if spec is `specs/issue-64-adw-xyz-feature.md`, save to `specs/issue-64-adw-xyz-feature-checklist.md`

5. Report to user:
   - "Validation checklist saved to: `<checklist_file_path>`"
   - "You can copy this checklist into GitHub PR comments"

**Edge Cases:**
- If spec file has no "## Acceptance Criteria" section, use empty list or note "No acceptance criteria found in spec"
- If validation commands section is missing, note "No validation commands specified"
- Ensure proper markdown escaping for special characters in criteria text
- Preserve the exact formatting of acceptance criteria from the spec

## Orchestration Patterns

Los workflows de orquestación completos incluyen fases de revisión automática con agentes especializados que validan el código contra especificaciones y criterios de aceptación. Consulta los comandos de orquestación para workflows multi-agente que incluyen revisión integrada:

- [orch_plan_w_scouts_build_review](./orch_plan_w_scouts_build_review.md) - Workflow completo que incluye fase de revisión automática
