# Feature Planning

Create a plan to implement a new feature in {{ config.project.name }} following the specified format.

## Variables
issue_number: $1
adw_id: $2
issue_json: $3

## Instructions
üö® **YOU ARE IN THE PLANNING PHASE** üö®

**CRITICAL - READ THIS FIRST:**
- You are creating a PLAN, NOT implementing the feature
- DO NOT create any final files (code, docs, configs, etc.)
- ONLY create ONE file: the plan in `{{ config.paths.specs_dir }}/` directory
- The plan will be executed later by another agent

**Planning Instructions:**

- IMPORTANT: You are creating a plan to implement a new feature for {{ config.project.name }}.
- The plan will be used to guide implementation with agentic coding.
- CRITICAL: Create the plan using RELATIVE path `{{ config.paths.specs_dir }}/issue-{issue_number}-adw-{adw_id}-feature_planner-{descriptive-name}.md`
- CRITICAL: NEVER use absolute paths (starting with /). ALWAYS use relative paths to current directory.
- CRITICAL: When using the Write tool, use ONLY `{{ config.paths.specs_dir }}/filename.md`, NOT `/Users/.../{{ config.paths.specs_dir }}/filename.md`
- Investigate the codebase to understand existing patterns before planning.
- IMPORTANT: Replace each <placeholder> in the format with real values.
- Use the reasoning model: think carefully about requirements and approach.
- Follow existing patterns and conventions in the project.
- If you need a new library, use `{{ config.commands.install }}` and report it in Notes.
- Keep it simple - don't use unnecessary decorators.

**‚ö° TOKEN OPTIMIZATION RULES (CRITICAL):**
- **DO NOT repeat issue body/title** - Already provided via `issue_json`, reference by ID only
- **Keep plan under 800 tokens** - Use bullets and short sentences, not prose
- **Output ONLY deltas** - Don't re-explain what's in the issue
- **Follow template exactly** - No additional sections or verbose explanations
- **Be surgical** - One line per file, one line per task

## Relevant Files

Key files for {{ config.project.name }}:

- `CLAUDE.md` - Agent guide
- `config.yml` - Project configuration
{% if config.paths.app_root %}
- `{{ config.paths.app_root }}/` - Application source code
{% endif %}

Read `.claude/commands/conditional_docs.md` for additional documentation.

## Plan Format

```md
# Feature: <feature name>

## Metadata
issue_number: `{issue_number}`
adw_id: `{adw_id}`
issue_json: `{issue_json}`

## Feature Description
<describe the feature in detail, its purpose and value>

## User Story
As a <user type>
I want to <action/goal>
So that <benefit/value>

## Problem Statement
<clearly define the problem or opportunity this feature addresses>

## Solution Statement
<describe the proposed approach and how it solves the problem>

## Relevant Files
Files needed to implement the feature:

<list relevant files with description of why they are relevant>

### New Files
<list new files to be created>

## Implementation Plan

### Phase 1: Foundation
<foundational work before implementing the main feature>

### Phase 2: Core Implementation
<main feature implementation>

### Phase 3: Integration
<integration with existing functionality>

## Step by Step Tasks
IMPORTANT: Execute each step in order.

### Task 1: <name>
- <detail>
- <detail>

### Task 2: <name>
- <detail>

<The last step should execute Validation Commands>

## Testing Strategy

### Unit Tests
<required unit tests>

### Edge Cases
<edge cases to test>

## Acceptance Criteria
<specific and measurable criteria to consider the feature complete>

## Validation Commands
Run all commands to validate with zero regressions:

{% if config.commands.test %}
- `{{ config.commands.test }}` - Run tests
{% endif %}
{% if config.commands.lint %}
- `{{ config.commands.lint }}` - Linting
{% endif %}
{% if config.commands.typecheck %}
- `{{ config.commands.typecheck }}` - Type check
{% endif %}

## Notes
<additional notes, future considerations, or relevant context>
```

## Feature
Extract feature details from the `issue_json` variable (parse JSON and use title and body fields).

## Report

üö® **CRITICAL OUTPUT FORMAT** üö®

YOU ARE BEING CALLED FROM AN AUTOMATED WORKFLOW. YOUR OUTPUT IS MACHINE-PARSED.

**STEP 1: Check for existing plan**
- Look in `{{ config.paths.specs_dir }}/` for files matching: `issue-{issue_number}-adw-{adw_id}-*.md`
- If found: Output ONLY the path and STOP. Do not create new files.

**STEP 2: Create plan file (if not exists)**
- Use Write tool with RELATIVE path: `{{ config.paths.specs_dir }}/issue-{issue_number}-adw-{adw_id}-feature_planner-{name}.md`
- NEVER use absolute paths starting with `/Users/` or `/home/`
- The file WILL be created in the CURRENT WORKING DIRECTORY
- DO NOT try to create files in other directories like `ai_docs/`, `adws/`, etc.

**STEP 3: Output ONLY the path**

YOUR FINAL OUTPUT **MUST** BE:
- Exactly ONE line
- ONLY the relative path
- NO markdown formatting
- NO explanations or commentary
- NO phrases like "Perfect!", "Done!", "Here is..."

‚úÖ CORRECT OUTPUT:
```
{{ config.paths.specs_dir }}/issue-564-adw-feature-Tac-13-Task-2-feature_planner-expertise-docs.md
```

‚ùå WRONG OUTPUT (will cause workflow failure):
```
Perfect! I created the plan at {{ config.paths.specs_dir }}/issue-564...
```

‚ùå WRONG OUTPUT (will cause workflow failure):
```
The plan file can be found at: {{ config.paths.specs_dir }}/issue-564...
```

**THIS IS MACHINE-PARSED. ANY TEXT OTHER THAN THE PATH WILL BREAK THE WORKFLOW.**
