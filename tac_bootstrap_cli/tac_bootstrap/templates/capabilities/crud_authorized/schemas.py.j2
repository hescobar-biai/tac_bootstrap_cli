"""
IDK: pydantic-schemas, {{ entity.snake_name }}, dto, multi-tenant

Module: {{ entity.snake_name }}_schemas

Responsibility:
- Define Pydantic schemas for {{ entity.name }} entity with multi-tenant support
- Provide Create, Update, and Response DTOs
- Handle serialization and validation
- Exclude organization_id from Create/Update (set server-side for security)

Key Components:
- {{ entity.name }}Create: Schema for creating new {{ entity.snake_name }}
- {{ entity.name }}Update: Schema for updating existing {{ entity.snake_name }}
- {{ entity.name }}Response: Schema for API responses (includes organization_id)

Related Docs:
- docs/{{ entity.capability }}/schemas/{{ entity.snake_name }}.md
"""

from pydantic import BaseModel, Field
{% set has_uuid = entity.fields | selectattr('field_type.value', 'equalto', 'uuid') | list | length > 0 %}
{% set has_datetime = entity.fields | selectattr('field_type.value', 'equalto', 'datetime') | list | length > 0 %}
{% set has_decimal = entity.fields | selectattr('field_type.value', 'equalto', 'decimal') | list | length > 0 %}
{% set has_json = entity.fields | selectattr('field_type.value', 'equalto', 'json') | list | length > 0 %}
{% if has_uuid %}
from uuid import UUID
{% endif %}
{% if has_datetime %}
from datetime import datetime
{% endif %}
{% if has_decimal %}
from decimal import Decimal
{% endif %}
{% if has_json %}
from typing import Dict, Any, Optional
{% else %}
from typing import Optional
{% endif %}
from {{ config.project.name | replace("-", "_") }}.shared.schemas.base_schema import BaseCreate, BaseUpdate, BaseResponse


class {{ entity.name }}Create(BaseCreate):
    """
    IDK: create-schema, {{ entity.snake_name }}, validation, multi-tenant

    Responsibility:
    - Validate data for creating new {{ entity.name }}
    - Define required and optional fields
    - Exclude organization_id and created_by (set server-side from JWT token)

    Invariants:
{% for field in entity.fields %}
{% if field.required %}
    - {{ field.name }} is required
{% endif %}
{% endfor %}
    - organization_id and created_by are NOT in this schema (injected server-side)

    Related Docs:
    - docs/{{ entity.capability }}/schemas/{{ entity.snake_name }}-create.md
    """

{% set type_map = {
    'str': 'str',
    'int': 'int',
    'float': 'float',
    'bool': 'bool',
    'datetime': 'datetime',
    'uuid': 'UUID',
    'text': 'str',
    'decimal': 'Decimal',
    'json': 'Dict[str, Any]'
} %}
{% for field in entity.fields %}
    {{ field.name }}: {{ type_map[field.field_type.value] }}{% if not field.required %} | None{% endif %} = Field(
{% if not field.required %}
        default=None,
{% elif field.default is not none %}
        default={{ field.default }},
{% else %}
        ...,
{% endif %}
{% if field.max_length and field.field_type.value == 'str' %}
        max_length={{ field.max_length }},
{% endif %}
        description="{{ field.name | replace('_', ' ') | title }}"
    )
{% endfor %}


class {{ entity.name }}Update(BaseUpdate):
    """
    IDK: update-schema, {{ entity.snake_name }}, partial-update, multi-tenant

    Responsibility:
    - Validate data for updating {{ entity.name }}
    - Allow partial updates (all fields optional)
    - Exclude organization_id and created_by (cannot be changed)

    Invariants:
    - All fields are optional
    - Only provided fields will be updated
    - organization_id cannot be changed (tenant isolation)

    Related Docs:
    - docs/{{ entity.capability }}/schemas/{{ entity.snake_name }}-update.md
    """

{% for field in entity.fields %}
    {{ field.name }}: Optional[{{ type_map[field.field_type.value] }}] = Field(
        default=None,
{% if field.max_length and field.field_type.value == 'str' %}
        max_length={{ field.max_length }},
{% endif %}
        description="{{ field.name | replace('_', ' ') | title }}"
    )
{% endfor %}


class {{ entity.name }}Response(BaseResponse):
    """
    IDK: response-schema, {{ entity.snake_name }}, serialization, multi-tenant

    Responsibility:
    - Serialize {{ entity.name }} for API responses
    - Include all entity fields and inherited base fields
    - Include organization_id for client-side validation

    Invariants:
    - Includes id, created_at, updated_at, created_by from BaseResponse
    - Includes organization_id for transparency
    - Includes all {{ entity.name }}-specific fields

    Related Docs:
    - docs/{{ entity.capability }}/schemas/{{ entity.snake_name }}-response.md
    """

{% for field in entity.fields %}
    {{ field.name }}: {{ type_map[field.field_type.value] }}{% if not field.required %} | None{% endif %} = Field(
        ...,
{% if field.max_length and field.field_type.value == 'str' %}
        max_length={{ field.max_length }},
{% endif %}
        description="{{ field.name | replace('_', ' ') | title }}"
    )
{% endfor %}
