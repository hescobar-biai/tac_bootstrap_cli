"""
IDK: api-routes, {{ entity.snake_name }}, rest-endpoints

Module: {{ entity.snake_name }}_routes

Responsibility:
- Define FastAPI routes for {{ entity.name }} CRUD operations
- Handle HTTP request/response
- Delegate business logic to service layer

Key Components:
- router: FastAPI router with {{ entity.name }} endpoints

Related Docs:
- docs/{{ entity.capability }}/api/{{ entity.snake_name }}.md
"""

from fastapi import APIRouter, Depends, HTTPException, status
from {{ config.project.name | replace("-", "_") }}.shared.dependencies import get_db
from .schemas import {{ entity.name }}Create, {{ entity.name }}Update, {{ entity.name }}Response
from .service import {{ entity.name }}Service
from .repository import {{ entity.name }}Repository
from typing import List

router = APIRouter(prefix="/{{ entity.plural_name }}", tags=["{{ entity.plural_name }}"])


def get_{{ entity.snake_name }}_service(db = Depends(get_db)) -> {{ entity.name }}Service:
    """
    IDK: dependency-injection, service-factory

    Responsibility:
    - Create {{ entity.name }}Service instance with database session

    Inputs:
    - db: Database session from dependency

    Outputs:
    - {{ entity.name }}Service: Service instance
    """
    repository = {{ entity.name }}Repository(db)
    return {{ entity.name }}Service(repository)


@router.post(
    "/",
    response_model={{ entity.name }}Response,
    status_code=status.HTTP_201_CREATED,
    summary="Create {{ entity.name }}",
    description="Create a new {{ entity.snake_name }} entity"
)
async def create_{{ entity.snake_name }}(
    data: {{ entity.name }}Create,
    service: {{ entity.name }}Service = Depends(get_{{ entity.snake_name }}_service)
) -> {{ entity.name }}Response:
    """
    IDK: create-endpoint, post-request, crud

    Responsibility:
    - Handle {{ entity.name }} creation requests
    - Validate input data
    - Return created entity

    Inputs:
    - data: {{ entity.name }}Create schema with entity data
    - service: Injected {{ entity.name }}Service

    Outputs:
    - {{ entity.name }}Response: Created entity

    Raises:
    - 422: Validation error
    - 500: Server error

    Related Docs:
    - docs/{{ entity.capability }}/api/{{ entity.snake_name }}-create.md
    """
    entity = service.create(data)
    return {{ entity.name }}Response(**entity.model_dump())


@router.get(
    "/{id}",
    response_model={{ entity.name }}Response,
    status_code=status.HTTP_200_OK,
    summary="Get {{ entity.name }} by ID",
    description="Retrieve a {{ entity.snake_name }} by its unique identifier"
)
async def get_{{ entity.snake_name }}(
    id: str,
    service: {{ entity.name }}Service = Depends(get_{{ entity.snake_name }}_service)
) -> {{ entity.name }}Response:
    """
    IDK: read-endpoint, get-request, crud

    Responsibility:
    - Handle {{ entity.name }} retrieval by ID
    - Return entity if found

    Inputs:
    - id: Entity unique identifier
    - service: Injected {{ entity.name }}Service

    Outputs:
    - {{ entity.name }}Response: Found entity

    Raises:
    - 404: Entity not found
    - 500: Server error

    Related Docs:
    - docs/{{ entity.capability }}/api/{{ entity.snake_name }}-get.md
    """
    entity = service.get_by_id(id)
    if not entity:
        raise HTTPException(status_code=404, detail="{{ entity.name }} not found")
    return {{ entity.name }}Response(**entity.model_dump())


@router.get(
    "/",
    response_model=List[{{ entity.name }}Response],
    status_code=status.HTTP_200_OK,
    summary="List {{ entity.plural_name }}",
    description="Retrieve all {{ entity.plural_name }} with pagination"
)
async def list_{{ entity.plural_name }}(
    skip: int = 0,
    limit: int = 100,
    service: {{ entity.name }}Service = Depends(get_{{ entity.snake_name }}_service)
) -> List[{{ entity.name }}Response]:
    """
    IDK: list-endpoint, get-request, pagination

    Responsibility:
    - Handle {{ entity.name }} listing requests
    - Support pagination
    - Return list of entities

    Inputs:
    - skip: Number of records to skip (default: 0)
    - limit: Maximum records to return (default: 100)
    - service: Injected {{ entity.name }}Service

    Outputs:
    - List[{{ entity.name }}Response]: List of entities

    Raises:
    - 500: Server error

    Related Docs:
    - docs/{{ entity.capability }}/api/{{ entity.snake_name }}-list.md
    """
    entities = service.get_all(skip=skip, limit=limit)
    return [{{ entity.name }}Response(**entity.model_dump()) for entity in entities]


@router.put(
    "/{id}",
    response_model={{ entity.name }}Response,
    status_code=status.HTTP_200_OK,
    summary="Update {{ entity.name }}",
    description="Update an existing {{ entity.snake_name }}"
)
async def update_{{ entity.snake_name }}(
    id: str,
    data: {{ entity.name }}Update,
    service: {{ entity.name }}Service = Depends(get_{{ entity.snake_name }}_service)
) -> {{ entity.name }}Response:
    """
    IDK: update-endpoint, put-request, crud

    Responsibility:
    - Handle {{ entity.name }} update requests
    - Validate input data
    - Return updated entity

    Inputs:
    - id: Entity unique identifier
    - data: {{ entity.name }}Update schema with update data
    - service: Injected {{ entity.name }}Service

    Outputs:
    - {{ entity.name }}Response: Updated entity

    Raises:
    - 404: Entity not found
    - 422: Validation error
    - 500: Server error

    Related Docs:
    - docs/{{ entity.capability }}/api/{{ entity.snake_name }}-update.md
    """
    entity = service.update(id, data)
    if not entity:
        raise HTTPException(status_code=404, detail="{{ entity.name }} not found")
    return {{ entity.name }}Response(**entity.model_dump())


@router.delete(
    "/{id}",
    response_model={{ entity.name }}Response,
    status_code=status.HTTP_200_OK,
    summary="Delete {{ entity.name }}",
    description="Soft delete a {{ entity.snake_name }}"
)
async def delete_{{ entity.snake_name }}(
    id: str,
    service: {{ entity.name }}Service = Depends(get_{{ entity.snake_name }}_service)
) -> {{ entity.name }}Response:
    """
    IDK: delete-endpoint, delete-request, soft-delete

    Responsibility:
    - Handle {{ entity.name }} deletion requests
    - Perform soft delete (mark as deleted)
    - Return deleted entity

    Inputs:
    - id: Entity unique identifier
    - service: Injected {{ entity.name }}Service

    Outputs:
    - {{ entity.name }}Response: Deleted entity

    Raises:
    - 404: Entity not found
    - 500: Server error

    Related Docs:
    - docs/{{ entity.capability }}/api/{{ entity.snake_name }}-delete.md
    """
    entity = service.soft_delete(id)
    if not entity:
        raise HTTPException(status_code=404, detail="{{ entity.name }} not found")
    return {{ entity.name }}Response(**entity.model_dump())
