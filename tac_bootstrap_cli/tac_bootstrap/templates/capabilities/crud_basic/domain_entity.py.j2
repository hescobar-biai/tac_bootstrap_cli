"""
IDK: domain-entity, {{ config.entity.snake_name }}, business-logic

Module: {{ config.entity.snake_name }}

Responsibility:
- Implement {{ config.entity.name }} domain entity
- Enforce business rules and invariants
- Provide domain-specific operations

Key Components:
- {{ config.entity.name }}: Domain entity with business logic

Related Docs:
- docs/{{ config.entity.capability }}/domain/{{ config.entity.snake_name }}.md
"""

from pydantic import Field
{% set has_uuid = config.entity.fields | selectattr('type', 'equalto', 'uuid') | list | length > 0 %}
{% set has_datetime = config.entity.fields | selectattr('type', 'equalto', 'datetime') | list | length > 0 %}
{% set has_decimal = config.entity.fields | selectattr('type', 'equalto', 'decimal') | list | length > 0 %}
{% set has_json = config.entity.fields | selectattr('type', 'equalto', 'json') | list | length > 0 %}
{% if has_uuid %}
from uuid import UUID
{% endif %}
{% if has_datetime %}
from datetime import datetime
{% endif %}
{% if has_decimal %}
from decimal import Decimal
{% endif %}
{% if has_json %}
from typing import Dict, Any
{% endif %}
from {{ config.config.project.name | replace("-", "_") }}.shared.domain.base_entity import Entity


class {{ config.entity.name }}(Entity):
    """
    IDK: domain-entity, {{ config.entity.snake_name }}, aggregate-root

    Responsibility:
    - Represent {{ config.entity.name }} domain entity
    - Enforce business rules and constraints
    - Provide domain operations

    Invariants:
    - Inherits all Entity invariants (id, audit trail, state management)
{% for field in config.entity.fields %}
    - {{ field.name }}: {{ 'required' if not field.nullable else 'optional' }} {{ field.type }}
{% endfor %}

    Related Docs:
    - docs/{{ config.entity.capability }}/domain/{{ config.entity.snake_name }}.md
    """

    type: str = Field(
        default="{{ config.entity.snake_name }}",
        description="Entity type discriminator"
    )

{% set type_map = {
    'str': 'str',
    'int': 'int',
    'float': 'float',
    'bool': 'bool',
    'datetime': 'datetime',
    'uuid': 'UUID',
    'text': 'str',
    'decimal': 'Decimal',
    'json': 'Dict[str, Any]'
} %}
{% for field in config.entity.fields %}
    {{ field.name }}: {{ type_map[field.type] }}{% if field.nullable %} | None{% endif %} = Field(
{% if field.nullable %}
        default=None,
{% elif field.default is not none %}
        default={{ field.default }},
{% else %}
        ...,
{% endif %}
{% if field.max_length and field.type == 'str' %}
        max_length={{ field.max_length }},
{% endif %}
        description="{{ field.name | replace('_', ' ') | title }}"
    )
{% endfor %}

    def validate(self) -> None:
        """
        IDK: validation, business-rules, invariants

        Responsibility:
        - Validate business rules and constraints
        - Ensure entity integrity

        Invariants:
        - All business rules must pass
        - Raises ValueError on validation failure

        Inputs:
        - None

        Outputs:
        - None (raises ValueError on failure)

        Related Docs:
        - docs/{{ config.entity.capability }}/domain/{{ config.entity.snake_name }}-validation.md
        """
        # TODO: Implement business validation rules
        pass

    def calculate_totals(self) -> None:
        """
        IDK: calculation, business-logic, derived-values

        Responsibility:
        - Calculate derived values and totals
        - Update computed fields

        Invariants:
        - Calculations are idempotent
        - Based on current entity state

        Inputs:
        - None

        Outputs:
        - None (mutates self)

        Related Docs:
        - docs/{{ config.entity.capability }}/domain/{{ config.entity.snake_name }}-calculations.md
        """
        # TODO: Implement business calculations
        pass
