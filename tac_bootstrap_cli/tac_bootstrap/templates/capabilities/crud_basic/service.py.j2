"""
IDK: service-layer, {{ entity.snake_name }}, business-logic

Module: {{ entity.snake_name }}_service

Responsibility:
- Implement {{ entity.name }} business operations
- Orchestrate domain logic and data access
- Handle business rules and validation

Key Components:
- {{ entity.name }}Service: Business logic layer for {{ entity.name }}

Related Docs:
- docs/{{ entity.capability }}/services/{{ entity.snake_name }}.md
"""

from {{ config.project.name | replace("-", "_") }}.shared.services.base_service import BaseService
from .domain import {{ entity.name }}
from .schemas import {{ entity.name }}Create, {{ entity.name }}Update, {{ entity.name }}Response
from .repository import {{ entity.name }}Repository
from typing import List, Optional


class {{ entity.name }}Service(BaseService[{{ entity.name }}, {{ entity.name }}Create, {{ entity.name }}Update]):
    """
    IDK: service-layer, {{ entity.snake_name }}, crud-operations

    Responsibility:
    - Manage {{ entity.name }} business operations
    - Apply business rules before persistence
    - Coordinate between domain and repository layers

    Invariants:
    - All business rules validated before saving
    - Transactions managed by BaseService

    Related Docs:
    - docs/{{ entity.capability }}/services/{{ entity.snake_name }}-operations.md
    """

    def __init__(self, repository: {{ entity.name }}Repository):
        """
        IDK: initialization, dependency-injection

        Responsibility:
        - Initialize service with repository

        Inputs:
        - repository: {{ entity.name }}Repository instance

        Outputs:
        - None
        """
        super().__init__(repository)
        self.repository = repository

    def apply_business_rules(self, entity: {{ entity.name }}) -> {{ entity.name }}:
        """
        IDK: business-rules, validation, domain-logic

        Responsibility:
        - Apply business rules before saving
        - Validate entity integrity
        - Perform calculations

        Inputs:
        - entity: {{ entity.name }} instance to validate

        Outputs:
        - {{ entity.name }}: validated entity

        Related Docs:
        - docs/{{ entity.capability }}/services/{{ entity.snake_name }}-business-rules.md
        """
        entity.validate()
        entity.calculate_totals()
        return entity
